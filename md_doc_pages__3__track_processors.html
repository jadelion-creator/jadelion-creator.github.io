<!-- HTML header for doxygen 1.9.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="dark-mode">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Timeline Mixer Documentation: Track Processors</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Timeline Mixer Documentation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_doc_pages__3__track_processors.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Track Processors </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Track processors are executed once per track during the <a class="el" href="namespace_timeline_mixer.html">TimelineMixer</a>'s setup phase, or when rebinding a track at runtime. They handle the setup of connections to mixers and outputs on the PlayableGraph, and also the disconnection process.</p>
<p >In short, they tell Timeline Mixer what to do with this track, and how to connect it on Timeline mixers PlayableGraph.</p>
<blockquote class="doxtable">
<p >&zwj;Basic knowledge of the Unity Playables API is recommended before proceeding with this section. The code examples are heavily commented, but reviewing Unitys Playables documentation will make this easier to understand. </p>
</blockquote>
<p>Let's look at the Playable Graph generated by the <code>SignalTrackProcessor</code>:</p>
<div class="image">
<img src="TrackProcessors_Signal.png" alt=""/>
</div>
    <p >Track processors manage the section highlighted in red. They connect the Timeline to any required mixer and other playables, and then to the output (which is bound to your component).</p>
<p >In signal tracks, this Passthrough playable is not strictly necessary but serves as a good example for creating a custom track processor with your own mixer.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Custom Track Processors</h1>
<p >You can customize how the timeline connects to its outputs on the Playable Graph by using a custom Track Processor. If your custom track doesn't have a specialized track processor, <a class="el" href="namespace_timeline_mixer.html">TimelineMixer</a> will use a default one.</p>
<p >To create one, follow these steps:</p>
<ol type="1">
<li>Create a new C# script.</li>
<li>Add the <code>TrackProcessor</code> attribute, passing in the type of the timeline track.</li>
<li>Inherit from <code>TrackProcessor</code> instead of <code>MonoBehaviour</code>.</li>
<li>Override the <code>ProcessTrack</code> method and connect your playables there.</li>
<li>Override the <code>DisconnectTrack</code> method if you use custom disconnection logic for rebinding tracks</li>
</ol>
<p >Here's an example, this is the LightControlTrackProcessor included with the <a class="el" href="namespace_timeline_mixer.html">TimelineMixer</a> package:</p>
<div class="fragment"><div class="line">[TrackProcessor(typeof(LightControlTrack))]</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">class </span>LightControlTrackProcessor : TrackProcessor</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//Store already generated outputs in a dictionary, this lets us find them later and connect to a mixer if that applies to your track</span></div>
<div class="line">        <span class="keyword">public</span> Dictionary&lt;Light, ScriptPlayableOutput&gt; lightOutputs = <span class="keyword">new</span> Dictionary&lt;Light, ScriptPlayableOutput&gt;();</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">private</span> Dictionary&lt;Playable, PlayableNode&gt; mixerNodes = <span class="keyword">new</span> Dictionary&lt;Playable, PlayableNode&gt;();</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> ProcessTrack(PlayableGraph graph, TrackAsset track, ScriptPlayable&lt;TimelinePlayable&gt; playable, <span class="keywordtype">int</span> trackIndex, Object boundComponent, ref PlayableConnectionInfo info)</div>
<div class="line">        {</div>
<div class="line">            ScriptPlayableOutput output;</div>
<div class="line">            Playable lightMixer;</div>
<div class="line">            PlayableNode lightMixerNode; <span class="comment">//Wrapper for playables</span></div>
<div class="line"> </div>
<div class="line">            <span class="comment">//Skip if the track is empty or has no binding</span></div>
<div class="line">            <span class="keywordflow">if</span> (track.isEmpty &amp;&amp; !track.hasClips) <span class="keywordflow">return</span>;</div>
<div class="line">            <span class="keywordflow">if</span> (boundComponent == <span class="keyword">null</span>) <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">//Check if an output already exists for this Light component</span></div>
<div class="line">            <span class="keywordflow">if</span> (lightOutputs.ContainsKey(boundComponent as Light))</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">//We&#39;ve found an output, from this we can get the mixer, and the PlayableNode wrapper for it</span></div>
<div class="line">                lightOutputs.TryGetValue(boundComponent as Light, out output);</div>
<div class="line">                lightMixer = output.GetSourcePlayable();</div>
<div class="line">                mixerNodes.TryGetValue(lightMixer, out lightMixerNode);</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">//If no output is found, create a new one</span></div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">//Create output</span></div>
<div class="line">                output = ScriptPlayableOutput.Create(graph, track.name);</div>
<div class="line">                lightOutputs.Add(boundComponent as Light, output);</div>
<div class="line"> </div>
<div class="line">                <span class="comment">//Create and store mixer</span></div>
<div class="line">                lightMixer = ScriptPlayable&lt;LightControlMixer&gt;.Create(graph);</div>
<div class="line">                ScriptPlayable&lt;LightControlMixer&gt; scriptPlayable = (ScriptPlayable&lt;LightControlMixer&gt;)lightMixer;</div>
<div class="line">                lightMixerNode = <span class="keyword">new</span> PlayableNode(lightMixer);</div>
<div class="line">                lightMixerNode.Name = <span class="stringliteral">&quot;Light Mixer Node&quot;</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="comment">//The custom made mixer requires a reference to its PlayableNode wrapper to make graph traversal easier</span></div>
<div class="line">                scriptPlayable.GetBehaviour().SetPlayableNode(lightMixerNode);</div>
<div class="line"> </div>
<div class="line">                mixerNodes.Add(lightMixer, lightMixerNode);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="comment">//Connect output to the mixer</span></div>
<div class="line">            output.SetSourcePlayable(lightMixerNode.GetPlayable());</div>
<div class="line"> </div>
<div class="line">            <span class="comment">//Set the bound component for the output</span></div>
<div class="line">            output.SetUserData(boundComponent as Light);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">//Finally, connect the mixer node to the timeline node using the ConnectPlayable method, this lets TimelineMixer set connection weights</span></div>
<div class="line">            ConnectPlayable(lightMixerNode, info.GetTimelineNode(), trackIndex, ref info);</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --><p >This example would make a track processor that is applied to a custom timeline track called LightControlTrack.</p>
<blockquote class="doxtable">
<p >&zwj;Track processors are discovered automatically at runtime through reflection </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md10"></a>
The PlayableNode class</h1>
<p >PlayableNode provides a lot of quality of life features, its purpose is to wrap a Playable such as AnimationMixerPlayable and track its connections, and make connecting and disconnecting easier.</p>
<p >You can find out what ports on one Playable are connected which ports on another, not an easy task normally.</p>
<p >Instead of directly connecting Playables to each other, wrap them in a PlayableNode and use that to connect to other PlayableNodes. Doing this tracks all your connections, and makes navigating downstream AND upstream on the graph possible in an easy way. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer"></li>
  </ul>
</div>
</body>
</html>
